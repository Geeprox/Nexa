# 设计 V1: 整体视觉语言规范 (Visual Language System)

## 1. 目标与范围
- 目标: 为 Nexa 提供统一、可扩展、可实现的视觉语言，支撑「研究、分叉、沉淀」的核心体验。
- 适用范围: Web 前端 (Next.js + Tailwind + shadcn 风格组件) 与 Tauri 桌面壳内 UI。
- V1 范围:
  - 覆盖基础视觉 token、核心布局、核心组件、状态与动效规范。
  - 不实现主题编辑器与多品牌皮肤，但需预留 token 扩展。

## 2. 信息气质与品牌语义
- 关键词: 冷静、可信、可回溯、可聚焦。
- 风格基调: Notion 风格的低干扰工作面 + 研究工具的结构化信息密度。
- 体验原则:
  - 内容优先: 降低装饰感，强调信息层级与阅读连续性。
  - 图谱可操作: 节点、连线、选区、聚焦态必须一眼可辨。
  - 长时使用: 控制对比与饱和度，避免高刺激颜色大面积出现。
  - 渐进增强: V1 以浅色主题为主，深色主题仅保留 token 接口。

## 3. 设计 Token 体系

### 3.1 色彩系统 (Light)
- 设计策略: 暖灰纸面 + 中性墨色 + 单一低饱和强调色。
- 基础语义 token:
  - `--background`: `36 33% 98%` (主背景，纸面色)
  - `--foreground`: `222 20% 20%` (正文文字)
  - `--card`: `0 0% 100%` (卡片背景)
  - `--card-foreground`: `222 20% 20%`
  - `--primary`: `222 15% 20%` (主操作色，深墨)
  - `--primary-foreground`: `0 0% 98%`
  - `--secondary`: `30 20% 94%` (次级块背景)
  - `--secondary-foreground`: `222 20% 20%`
  - `--muted`: `30 12% 92%` (弱背景)
  - `--muted-foreground`: `222 10% 40%` (弱文字)
  - `--accent`: `40 20% 90%` (轻强调背景)
  - `--accent-foreground`: `222 20% 20%`
  - `--destructive`: `0 72% 51%`
  - `--destructive-foreground`: `0 0% 98%`
  - `--border`: `30 18% 88%`
  - `--input`: `30 18% 88%`
  - `--ring`: `222 15% 20%`
- 专用扩展 token:
  - `--selection`: `45 90% 85%` (文本选区高亮)
  - `--graph-edge`: `220 12% 70%` (图谱连线)
  - `--graph-edge-active`: `222 20% 28%`
  - `--auto-tag`: `44 85% 56%` (自动标签标识色)
  - `--manual-tag`: `222 18% 38%` (手动标签标识色)

### 3.2 字体系统
- 中文优先字体栈:
  - UI 正文: `"SF Pro Text", "PingFang SC", "Hiragino Sans GB", "Noto Sans CJK SC", sans-serif`
  - 数字/代码: `"SF Mono", "JetBrains Mono", ui-monospace, monospace`
- 字号层级:
  - Display: `28/36`, `weight 650` (仅用于极少数页面标题)
  - H1: `22/32`, `weight 650`
  - H2: `18/28`, `weight 600`
  - H3: `16/24`, `weight 600`
  - Body M: `14/22`, `weight 400`
  - Body S: `13/20`, `weight 400`
  - Caption: `12/18`, `weight 500`
- 文本规则:
  - 正文最大阅读宽度建议 `72ch`。
  - 长段落默认左对齐，不使用两端对齐。
  - 混排场景优先保证中文行高稳定，避免行高抖动。

### 3.3 间距与栅格
- 基础单位: `4px`。
- 语义间距:
  - `space-1=4`, `space-2=8`, `space-3=12`, `space-4=16`, `space-5=20`, `space-6=24`, `space-8=32`, `space-10=40`, `space-12=48`。
- 布局栅格:
  - 顶层采用 `Sidebar + 主工作区 + 右图谱` 三段式。
  - V1 标准: 左侧栏 `280px`，右图谱栏 `360px`，中间自适应。
  - 低宽度降级 (<=1200px): 右图谱可切换抽屉或覆盖层。

### 3.4 圆角、边框、阴影
- 圆角:
  - 输入与按钮: `8px`
  - 卡片: `12px`
  - 浮层: `14px`
- 边框:
  - 默认边框 `1px solid hsl(var(--border))`
  - 焦点环 `2px` 外环，颜色 `hsl(var(--ring) / 0.35)`
- 阴影:
  - `shadow-xs`: 微弱悬浮
  - `shadow-sm`: 操作卡片/分叉按钮
  - `shadow-md`: 弹层与菜单
  - 禁止大面积重阴影，保持“纸面工具”质感

## 4. 核心布局规范

### 4.1 全局结构
- 左栏: 导航、搜索、标签入口、系统状态摘要。
- 中栏: 对话主阅读/输入区，承担深度阅读与分叉触发。
- 右栏: 图谱画布，承担结构浏览、跳转与节点管理。

### 4.2 层级关系
- 信息层级优先级:
  1. 选区与可分叉提示
  2. 当前激活分支与相关节点
  3. 正文消息内容
  4. 全局操作按钮
  5. 装饰性背景与纹理
- 任意时刻仅允许一个“主聚焦对象”: 当前分支节点或当前选中内容。

## 5. 组件视觉规范

### 5.1 Sidebar
- 背景: 半透明白底 + 轻模糊 (`bg-white/60 + backdrop-blur`)。
- 导航项:
  - 默认态弱对比，Hover 提升背景对比。
  - Active 态使用 `bg-muted` + `font-medium` + 左侧强调条 (预留)。
- 搜索框:
  - 视觉风格为“可点击输入容器”。
  - 占位文本使用 `muted-foreground`，避免与正文竞争。

### 5.2 TopBar
- 采用细边框与半透明底，弱化工具栏侵入感。
- 主操作按钮:
  - 统一高度 `32px`。
  - 图标与文本间距 `8px`。
  - Hover 态仅轻度底色变化，不做高饱和填充。
- 状态胶囊:
  - 自动标签开启状态使用弱强调底色，避免警报色。

### 5.3 Chat Pane
- 消息卡片:
  - 用户消息: 靠右、`bg-secondary`。
  - 助手消息: 靠左、`bg-card`。
  - 圆角 `16px`，行高 `22px`，正文 `14px`。
- 分叉触发:
  - 仅在 assistant 消息内有效。
  - 选区出现后展示浮动“分叉”按钮，按钮尺寸最小 `28px` 高。
  - 触发后清空浏览器选区并高亮目标分支 (交互闭环)。

### 5.4 Graph Pane
- 画布容器:
  - 外层使用弱边框与留白，避免与聊天区视觉混叠。
  - 背景网格弱可见，不可喧宾夺主。
- 节点卡片:
  - 默认态白底细边框，激活态 `bg-muted + foreground border`。
  - 标题一行省略，副文案使用 `12px muted-foreground`。
- 连线:
  - 默认静态细线，不做流光动画。
  - 仅在聚焦态或 hover 时提升线条对比。

### 5.5 Tag Chip (V1 必备)
- 标签需要区分来源:
  - 手动标签: 实线边框 + 中性前景色。
  - 自动标签: 虚线边框或轻底色 + 明确 icon (如 Sparkles)。
- 删除系统标签需有轻确认机制，避免误删。

## 6. 状态与反馈规范
- 交互状态: `default / hover / active / focused / disabled` 全覆盖。
- 空状态: 提供下一步引导语，不出现“空白死区”。
- 加载状态:
  - 聊天流式响应可用骨架/闪动点。
  - 图谱加载优先显示节点框架后补文本。
- 错误状态:
  - 使用 `destructive`，附短解释与恢复操作。
  - 禁止仅用颜色表达错误，需配合文案或图标。

## 7. 动效系统
- 动效目标: 帮助定位与理解结构变化，而非装饰。
- 时长规范:
  - 微交互: `120ms-160ms`
  - 面板切换: `180ms-220ms`
  - 图谱聚焦/定位: `220ms-280ms`
- 缓动:
  - 默认 `ease-out`
  - 拖拽跟手场景使用线性或近线性曲线
- 必须支持 `prefers-reduced-motion`，降级为无动画或淡入淡出。

## 8. 可访问性 (A11y)
- 对比度:
  - 正文文本 >= WCAG AA (`4.5:1`)
  - 大号文本/粗体 >= `3:1`
- 键盘:
  - 主流程可键盘完成 (导航、切换分支、触发分叉、删除标签)。
  - 焦点样式始终可见，不可被 `outline: none` 隐藏。
- 命中区域:
  - 可点击控件最小 `32x32`，优先 `36x36`。
- 语义:
  - 图标按钮必须有 `aria-label`。
  - 状态变化应可被屏幕阅读器感知 (`aria-live` 预留)。

## 9. 视觉规范到代码的映射建议
- Token 承载层:
  - 全局 token 放在 `src/app/globals.css` 的 `:root`。
  - 组件级 token 通过 Tailwind 语义类组合，不直接写硬编码颜色。
- 组件分层:
  - Layout 层 (Sidebar/TopBar) 管结构与全局感知。
  - Domain 层 (Chat/Graph/Tag) 管具体交互与状态。
- 约束:
  - 新组件默认复用语义 token。
  - 禁止绕过 token 直接引入高饱和临时色。

## 10. 验收清单 (V1)
- 所有主界面颜色来自语义 token，无魔法值散落。
- Sidebar/TopBar/Chat/Graph 的 hover、active、focus 状态齐全。
- 分叉触发从“选区出现 -> 点击分叉 -> 图谱聚焦”闭环可见。
- 自动标签与手动标签样式可一眼区分。
- 常见宽度 (`1280`, `1440`, `1728`) 下布局稳定，不发生信息重叠。
- 键盘可完成核心路径，焦点可见。
- 关键文本对比度通过 AA 校验。

## 11. V1 后续预留
- 深色主题 token 镜像表。
- 章节 (Chapters) 的封面样式与目录层级 token。
- 智能视图 (View) 的聚合卡片视觉语义。
- 导出与分享页面的阅读版样式模板。

